<!DOCTYPE html>

<link href='http://fonts.googleapis.com/css?family=Montserrat:light' rel='stylesheet' type='text/css'>
<html>

<html>
    <head>
        <meta charset = "UTF-8">
        <link rel = "stylesheet" href ="/src/index.css">
        <style>
            h2{text-align: center;}
            h1 {
                font-family: 'Montserrat';font-size: 22px;
            
            }

            h2 {
                font-family: 'Montserrat';font-size: 22px;
            
            }
        </style>   
        

    </head>

    <body>

    <h1>Welcome to the CFB Environmental Calculator!</h1>
    <h2 id="blurb">Using this tool, you are able to calculate the environmental impact of your donations 
        and see the broader effect you are having on your local and global community!</h2>
    <h2 id="question">What types of furniture would you like to donate?</h2>
    <img src="furniture.jpg" alt="furniture icons">
        <div id="table">
            <div id="column1">
                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value = "0" id = "myRange" class = "slider">
                    <p>Value: <span id ="value"></span> </p>
                </div>
                
                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value1 = "0" id = "myRange1" class = "slider1">
                    <p>Value: <span id ="value1"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value2 = "0" id = "myRange2" class = "slider2">
                    <p>Value: <span id ="value2"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value3 = "0" id = "myRange3" class = "slider3">
                    <p>Value: <span id ="value3"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value4 = "0" id = "myRange4" class = "slider4">
                    <p>Value: <span id ="value4"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value5 = "0" id = "myRange5" class = "slider5">
                    <p>Value: <span id ="value5"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value6 = "0" id = "myRange6" class = "slider6">
                    <p>Value: <span id ="value6"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value7 = "0" id = "myRange7" class = "slider7">
                    <p>Value: <span id ="value7"></span> </p>
                </div>
            </div>

            <div id="column2">
                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value8 = "0" id = "myRange8" class = "slider8">
                    <p>Value: <span id ="value8"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value9 = "0" id = "myRange9" class = "slider9">
                    <p>Value: <span id ="value9"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value10 = "0" id = "myRange10" class = "slider10">
                    <p>Value: <span id ="value10"></span> </p>
                </div>
                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value11 = "0" id = "myRange11" class = "slider11">
                    <p>Value: <span id ="value11"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value12 = "0" id = "myRange12" class = "slider12">
                    <p>Value: <span id ="value12"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value13 = "0" id = "myRange13" class = "slider13">
                    <p>Value: <span id ="value13"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value14 = "0" id = "myRange14" class = "slider14">
                    <p>Value: <span id ="value14"></span> </p>
                </div>

                <div class ="slideContainer">
                    <input type = "range" min = "0" max = "100" value15 = "0" id = "myRange15" class = "slider15">
                    <p>Value: <span id ="value15"></span> </p>
                </div>
            </div>
        </div>




    </body>



    
    <style type="text/css">
        #chart text {
            fill: black;
            font: 20px 'Montserrat';
            text-anchor: end;
        }
    
        .axis text {
            font: 10px 'Montserrat';
        }
    
        .axis path, .axis line {
            fill: none;
            /*stroke: #fff;*/
            shape-rendering: crispEdges;
        }

        .svg-container {
    display: inline-block;
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    vertical-align: top;
    overflow: hidden;
}
.svg-content {
    display: inline-block;
    position: absolute;
    top: 0;
    left: 0;
}
    
        body {
            /*background: #1a1a1a;*/
            color: #eaeaea;
            padding: 10px;
        }
    
        path {
            stroke: steelblue;
            stroke-width: 2;
            fill: none;
        }
    </style>
    <div id="chart" style="height:600px;width:1400px">
        <div class="innerCont" style="overflow: auto; top:100px; left: 500px; height:100% ; Width:100% ;position: relative;;" />
    </div>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.v2.min.js"></script>
    <script type="text/javascript">

        
    
        var salesData;
        var chartInnerDiv = '<div class="innerCont" style="overflow: auto;top:100px; left: 300px; height:91% ; Width:100% ;position: relative;"/>';
        var truncLengh = 30;
        
    
        $(document).ready(function () {
            Plot();
        });
    
        function Plot() {
            TransformChartData(chartData, chartOptions, 0);
            BuildPie("chart", chartData, chartOptions, 0)
        }
    
        function BuildPie(id, chartData, options, level) {
            var xVarName;
            var divisionRatio = 2.5;
            var legendoffset = (level == 100) ? -0 : 0;
    
            d3.selectAll("#" + id + " .innerCont").remove();
            $("#" + id).append(chartInnerDiv);
            chart = d3.select("#" + id + " .innerCont");
    
            var yVarName = options[0].yaxis;
            width = $(chart[0]).outerWidth(),
            height = $(chart[0]).outerHeight(),
            radius = Math.min(width, height) / divisionRatio;
    
            if (level == 1) {
                xVarName = options[0].xaxisl1;
            }
            else {
                xVarName = options[0].xaxis;
            }
    
            var rcolor = d3.scale.ordinal().range(runningColors);
    
            arc = d3.svg.arc()
                    .outerRadius(radius)
                    .innerRadius(radius - 200);
    
            var arcOver = d3.svg.arc().outerRadius(radius + 20).innerRadius(radius - 180);
    
            chart = chart
                    .append("svg")  //append svg element inside #chart
                    .attr("width", width)    //set width
                    .attr("height", height)  //set height
                    .append("g")
                    .attr("transform", "translate(" + (width / divisionRatio) + "," + ((height / divisionRatio) + 100) + ")");
    
            var pie = d3.layout.pie()
                        .sort(null)
                        .value(function (d) {
                            return d.Total;
                        });
    
            var g = chart.selectAll(".arc")
                        .data(pie(runningData))
                        .enter().append("g")
                        .attr("class", "arc");
    
            var count = 0;
    


	
            var sampleSVG = d3.select(".example_div")
                        .append("svg:svg")
                        .attr("class", "sample")
                        .attr("width", 300)
                        .attr("height", 300);    
	
            d3.select(".example_div svg")
                        .append("svg:circle")
                        .attr("stroke", "black")
                        .attr("fill", "aliceblue")
                        .attr("r", 50)
                        .attr("cx", 52)
                        .attr("cy", 52)
                        .on("mouseover", function(){return tooltip.style("visibility", "visible");})
                        .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
                        .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
    
            var path = g.append("path")
                        .attr("d", arc)
                        .attr("id", function (d) { return "arc-" + (count++); })
                        .style("opacity", function (d) {
                            return d.data["op"];
                        });
            
    
            path.on("mouseenter", function (d) {
                d3.select(this)
                    .attr("stroke", "white")
                    .transition()
                    .duration(200)
                    .attr("d", arcOver)
                    .attr("stroke-width", 1);
            })
             .on("mouseleave", function (d) {
                 d3.select(this).transition()
                     .duration(200)
                     .attr("d", arc)
                     .attr("stroke", "none");

             })
             .on("click", function (d) {
                 if (this._listenToEvents) {
                     // Reset inmediatelly
                     d3.select(this).attr("transform", "translate(0,0)")
                     // Change level on click if no transition has started
                     path.each(function () {
                         this._listenToEvents = false;
                     });
                 }
                 d3.selectAll("#" + id + " svg").remove();
                 if (level == 1) {
                     TransformChartData(chartData, options, 0, d.data[xVarName]);
                     BuildPie(id, chartData, options, 0);
                 }
                 else {
                     var nonSortedChart = chartData.sort(function (a, b) {
                         return parseFloat(b[options[0].yaxis]) - parseFloat(a[options[0].yaxis]);
                     });
                     TransformChartData(nonSortedChart, options, 1, d.data[xVarName]);
                     BuildPie(id, nonSortedChart, options, 1);
                 }
    
             });
    
            path.append("svg:title")
            .text(function (d) {
                return d.data["title"] + " (" + d.data[yVarName] + ")";
            });
    
            path.style("fill", function (d) {
                return rcolor(d.data[xVarName]);
            })
             .transition().duration(1000).attrTween("d", tweenIn).each("end", function () {
                 this._listenToEvents = true;
             });
    
    
            g.append("text")
             .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
             .attr("dy", ".35em")
             .style("text-anchor", "middle")
             .style("opacity", 1)
             .text(function (d) {
                 return d.data[yVarName];
             });
    
            count = 0;
            var legend = chart.selectAll(".legend")
                .data(runningData).enter()
                .append("g").attr("class", "legend")
                .attr("legend-id", function (d) {
                    return count++;
                })
                .attr("transform", function (d, i) {
                    return "translate(15," + (parseInt("-" + (runningData.length * 10)) + i * 35 + legendoffset) + ")";
                })
                .style("cursor", "pointer")
                .on("click", function () {
                    var oarc = d3.select("#" + id + " #arc-" + $(this).attr("legend-id"));
                    oarc.style("opacity", 0.3)
                    .attr("stroke", "white")
                    .transition()
                    .duration(200)
                    .attr("d", arcOver)
                    .attr("stroke-width", 1);
                    setTimeout(function () {
                        oarc.style("opacity", function (d) {
                            return d.data["op"];
                        })
                       .attr("d", arc)
                       .transition()
                       .duration(200)
                       .attr("stroke", "none");
                    }, 1000);
                });
    
            var leg = legend.append("rect");
    
            leg.attr("x", width / 2 )
                .attr("width", 18).attr("height", 18)
                .style("fill", function (d) {
                    return rcolor(d[yVarName]);
                })
                .style("opacity", function (d) {
                    return d["op"];
                });
            legend.append("text").attr("x", (width / 2))
                .attr("y", 9).attr("dy", ".35em")
                .style("text-anchor", "end").text(function (d) {
                    return d.caption;
                });
    
            leg.append("svg:title")
            .text(function (d) {
                return d["title"] + " (" + d[yVarName] + ")";
            });
    
            function tweenOut(data) {
                data.startAngle = data.endAngle = (2 * Math.PI);
                var interpolation = d3.interpolate(this._current, data);
                this._current = interpolation(0);
                return function (t) {
                    return arc(interpolation(t));
                };
            }
    
            function tweenIn(data) {
                var interpolation = d3.interpolate({ startAngle: 0, endAngle: 0 }, data);
                this._current = interpolation(0);
                return function (t) {
                    return arc(interpolation(t));
                };
            }
    
        }
    
        function TransformChartData(chartData, opts, level, filter) {
            var result = [];
            var resultColors = [];
            var counter = 0;
            var hasMatch;
            var xVarName;
            var yVarName = opts[0].yaxis;
    
            if (level == 1) {
                xVarName = opts[0].xaxisl1;
    
                for (var i in chartData) {
                    hasMatch = false;
                    for (var index = 0; index < result.length; ++index) {
                        var data = result[index];
    
                        if ((data[xVarName] == chartData[i][xVarName]) && (chartData[i][opts[0].xaxis]) == filter) {
                            result[index][yVarName] = result[index][yVarName] + chartData[i][yVarName];
                            hasMatch = true;
                            break;
                        }
    
                    }
                    if ((hasMatch == false) && ((chartData[i][opts[0].xaxis]) == filter)) {
                        if (result.length < 9) {
                            ditem = {}
                            ditem[xVarName] = chartData[i][xVarName];
                            ditem[yVarName] = chartData[i][yVarName];
                            ditem["caption"] = chartData[i][xVarName].substring(0, 10) + '...';
                            ditem["title"] = chartData[i][xVarName];
                            ditem["op"] = 1.0 - parseFloat("0." + (result.length));
                            result.push(ditem);
    
                            resultColors[counter] = opts[0].color[0][chartData[i][opts[0].xaxis]];
    
                            counter += 1;
                        }
                    }
                }
            }
            else {
                xVarName = opts[0].xaxis;
    
                for (var i in chartData) {
                    hasMatch = false;
                    for (var index = 0; index < result.length; ++index) {
                        var data = result[index];
    
                        if (data[xVarName] == chartData[i][xVarName]) {
                            result[index][yVarName] = result[index][yVarName] + chartData[i][yVarName];
                            hasMatch = true;
                            break;
                        }
                    }
                    if (hasMatch == false) {
                        ditem = {};
                        ditem[xVarName] = chartData[i][xVarName];
                        ditem[yVarName] = chartData[i][yVarName];
                        ditem["caption"] = opts[0].captions != undefined ? opts[0].captions[0][chartData[i][xVarName]] : "";
                        ditem["title"] = opts[0].captions != undefined ? opts[0].captions[0][chartData[i][xVarName]] : "";
                        ditem["op"] = 1;
                        result.push(ditem);
    
                        resultColors[counter] = opts[0].color != undefined ? opts[0].color[0][chartData[i][xVarName]] : "";
    
                        counter += 1;
                    }
                }
            }
    
    
            runningData = result;
            runningColors = resultColors;
            return;
        }
    
        chartOptions = [{
            "captions": [{ "CARBON": "Tons of Carbon", "ENERGY": "BTU's of Energy (million)", "OIL": "Barrels of Oil" , "ORE": "Iron Ore (lbs)", "LANDFILL": "Cubic Yards of Landfill Space", "TREES": "Trees Saved", "ELECTRCITY": "Electricity (kWH)"}],
            "color": [{ "CARBON": "#295F89", "ENERGY": "#1D4361", "OIL": "#347AB0", "ORE": "#4E94CA", "LANDFILL": "#74ABD6", "TREES": "#88B7DC", "ELECTRCITY": "#B0D0E8"}],
            "xaxis": "Polluant",
            "xaxisl1": "Model",
            "yaxis": "Total"
        }]
    
        var chartData = [
            {
                "Polluant": "ENERGY",
                "Model": "Model 1",
                "Total": 487
            },
            {
                "Polluant": "CARBON",
                "Model": "Model 1",
                "Total": 411
            },
            {
                "Polluant": "OIL",
                "Model": "Model 1",
                "Total": 500
            },
            {
                "Polluant": "ORE",
                "Model": "Model 1",
                "Total": 350
            },
            {
                "Polluant": "LANDFILL",
                "Model": "Model 1",
                "Total": 300
            },
            {
                "Polluant": "TREES",
                "Model": "Model 1",
                "Total": 200
            },
            {
                "Polluant": "ELECTRCITY",
                "Model": "Model 1",
                "Total": 200
            }
        ];
    
    </script>
</html>

    
    
</html>